<div class="conversation-panel" role="region" aria-label="Conversation history">
  @if (messages().length === 0 && !isLoading()) {
    <div class="empty-conversation">
      <p class="empty-title">No messages yet</p>
      <p class="empty-hint">Send a message to start the conversation</p>
    </div>
  } @else if (messages().length > 0) {
    <div class="messages-list">
      @for (message of messages(); track trackByMessageId($index, message)) {
        @if (isUserMessage(message)) {
          <app-user-message [message]="message" />
        }
        
        @if (isAssistantMessage(message)) {
          <app-ai-message
            [message]="message"
            [isLoading]="message.isLoading || false"
            [showTraces]="isMessageTracesExpanded(message.id)"
            [isTracesFeatureEnabled]="showTraces()"
            (toggleTraces)="handleToggleMessageTraces(message.id)"
          />
          
          @if (showTraces() && isMessageTracesExpanded(message.id) && !message.isLoading) {
            <div class="traces-section">
              @if (isLoadingTraces(message.id)) {
                <div class="traces-loading">
                <lib-loader [config]="loaderConfig" />
                </div>
              } @else {
                <div class="traces-list">
                  @for (trace of getTracesForMessage(message.id); track trackByTraceId($index, trace)) {
                    <app-reasoning-trace-item
                      [trace]="trace"
                      [isExpanded]="isTraceExpanded(trace.id)"
                      (toggleExpand)="handleToggleTrace(trace.id)"
                    />
                  }
                </div>
              }
            </div>
          }
        }
      }
    </div>
  }
</div>
